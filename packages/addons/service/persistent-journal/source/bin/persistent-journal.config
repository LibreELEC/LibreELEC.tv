#!/bin/sh

# SPDX-License-Identifier: GPL-2.0-or-later
# Copyright (C) 2021-present Team LibreELEC (https://libreelec.tv)

. /etc/profile

oe_setup_addon service.persistent-journal

PERSIST_CONF=/run/systemd/journald.conf.d/journald-persist.conf

mkdir -p /var/log
mkdir -p /run/systemd/journald.conf.d
mkdir -p /storage/.kodi/userdata/addon_data/service.persistent-journal/journal

ln -sf /storage/.kodi/userdata/addon_data/service.persistent-journal/journal /var/log/

cat <<-EOF >${PERSIST_CONF}
	[Journal]
	SystemMaxUse=${JOURNAL_SIZE}M
	MaxRetentionSec=0
	EOF

if [ "${DISABLE_RATE_LIMIT}" = "true" ]; then
  cat <<-EOF >>${PERSIST_CONF}
	RateLimitInterval=0
	RateLimitBurst=0
	EOF
fi

exit 0
